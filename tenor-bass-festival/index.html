<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Tenor-Bass Volunteers • Rowan ACDA</title>
<meta name="description" content="Volunteer sign-ups with live remaining slots."/>

<!-- Speed up the sheet fetch -->
<link rel="preconnect" href="https://docs.google.com" crossorigin>
<link rel="dns-prefetch" href="https://docs.google.com">

<link rel="preconnect" href="https://fonts.googleapis.com"/>
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin/>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&family=Outfit:wght@500;700;800&display=swap" rel="stylesheet"/>
<link rel="icon" href="/assets/icons/favicon-32.png"/>
<meta name="theme-color" content="#7A0A0A"/>
<link rel="stylesheet" href="/css/base.css"/>
<link rel="stylesheet" href="/css/layout.css"/>
<link rel="stylesheet" href="/css/components.css"/>

<style>
  /* Inline red “Add to Calendar” link */
  .event-meta .calendar-link{
    color:#7A0A0A; font-weight:700;
  }
  .event-meta .calendar-link:hover,
  .event-meta .calendar-link:focus{ text-decoration:underline; }

  /* Tags: red text + red outline (matches Events page) */
  .event-badges .badge{
    color:#7A0A0A; border:1.6px solid #7A0A0A; background:#fff; font-weight:700;
  }

  /* Hide scrollbar in any modal dialog, keep it scrollable */
  .modal .dialog{ overflow:auto; -ms-overflow-style:none; scrollbar-width:none; }
  .modal .dialog::-webkit-scrollbar{ display:none; }

  /* ===== Fading slideshow (bigger) ===== */
  .slideshow-wrap{
    border:1px solid var(--border);
    border-radius:1rem;
    overflow:hidden;
    background:#fff;
  }
  .slideshow{
    position:relative;
    width:100%;
    height:clamp(260px, 45vw, 540px); /* bigger, responsive */
    background:#f7f7f7;
  }
  .slideshow img{
    position:absolute; inset:0;
    width:100%; height:100%;
    object-fit:cover;
    opacity:0;
    transition:opacity 900ms ease;
    /* perf hints */
    backface-visibility:hidden;
    transform:translateZ(0);
    will-change:opacity;
  }
  .slideshow img.active{ opacity:1; }
  /* smoother, longer cross-fade */
.slideshow img{
  position:absolute; inset:0;
  width:100%; height:100%;
  object-fit:cover;
  opacity:0;
  transition: opacity 1.8s cubic-bezier(.22,.61,.36,1); /* was 900ms ease */
  backface-visibility:hidden;
  transform:translateZ(0);
  will-change:opacity;
}
/* Home only: hide tags and buttons inside Featured Events */
#home-events .event-badges,
#home-events .event-actions,
#home-events [data-modal],
#home-events [data-action="signin"]{
  display: none !important;
}

</style>
</head>
<body>
<header class="site-header" role="banner">
  <div class="container header-inner">
    <a class="brand" href="/" aria-label="Rowan ACDA Home">
      <img src="/assets/icons/acda.png" alt="ACDA logo">
      <span>Rowan ACDA</span>
    </a>
    <button id="nav-toggle" aria-controls="site-nav" aria-expanded="false" aria-label="Toggle navigation">☰</button>
    <nav id="site-nav" class="nav" role="navigation">
      <a class="nav-link" data-nav href="/">Home</a>
      <a class="nav-link" data-nav href="/events.html">Events</a>
      <a class="nav-link" data-nav href="/members.html">Members</a>
      <a class="nav-link" data-nav href="/eboard.html">E-Board</a>
      <a class="nav-link" data-nav href="/resources.html">Resources</a>
    </nav>
  </div>
</header>

<main id="content">
  <section class="section">
    <div class="container">
      <p class="eyebrow">ACDA Event</p>
      <h1>Tenor-Bass Festival — Volunteers</h1>
      <p class="muted">Pick a slot below. This page shows live remaining spots (like SignUpGenius). Your selection will prefill the form.</p>
    </div>
  </section>

  <section class="section">
    <div class="container">
      <div class="slots card">
        <div class="slots-head">
          <div>Role</div>
          <div class="center">Remaining</div>
          <div></div>
        </div>
        <div class="slots-body">
          
      <div class="slot-row" data-slot="Bus Crew (7:30–9:30)" data-capacity="4">
        <div class="slot-main">
          <div class="slot-title"><strong>Bus Crew</strong> <span class="muted">(7:30–9:30)</span> • <span class="muted">2 pts</span></div>
        </div>
        <div class="slot-remaining"><span class="pill pill-remaining" data-remaining="…">…</span></div>
        <div class="slot-action">
          <button class="btn btn-signup" type="button" data-pick="Bus Crew (7:30–9:30)">Sign Up</button>
        </div>
      </div>
    
      <div class="slot-row" data-slot="Lobby Ushers (7:30–9:30)" data-capacity="4">
        <div class="slot-main">
          <div class="slot-title"><strong>Lobby Ushers</strong> <span class="muted">(7:30–9:30)</span> • <span class="muted">2 pts</span></div>
        </div>
        <div class="slot-remaining"><span class="pill pill-remaining" data-remaining="…">…</span></div>
        <div class="slot-action">
          <button class="btn btn-signup" type="button" data-pick="Lobby Ushers (7:30–9:30)">Sign Up</button>
        </div>
      </div>
    
      <div class="slot-row" data-slot="Registration (7:30–9:30)" data-capacity="6">
        <div class="slot-main">
          <div class="slot-title"><strong>Registration</strong> <span class="muted">(7:30–9:30)</span> • <span class="muted">2 pts</span></div>
        </div>
        <div class="slot-remaining"><span class="pill pill-remaining" data-remaining="…">…</span></div>
        <div class="slot-action">
          <button class="btn btn-signup" type="button" data-pick="Registration (7:30–9:30)">Sign Up</button>
        </div>
      </div>
    
      <div class="slot-row" data-slot="Set-Up Crew (9:30–10:00)" data-capacity="6">
        <div class="slot-main">
          <div class="slot-title"><strong>Set-Up Crew</strong> <span class="muted">(9:30–10:00)</span> • <span class="muted">2 pts</span></div>
        </div>
        <div class="slot-remaining"><span class="pill pill-remaining" data-remaining="…">…</span></div>
        <div class="slot-action">
          <button class="btn btn-signup" type="button" data-pick="Set-Up Crew (9:30–10:00)">Sign Up</button>
        </div>
      </div>
    
      <div class="slot-row" data-slot="Lunch Bouncers (11:15–12:30)" data-capacity="6">
        <div class="slot-main">
          <div class="slot-title"><strong>Lunch Bouncers</strong> <span class="muted">(11:15–12:30)</span> • <span class="muted">3 pts</span></div>
        </div>
        <div class="slot-remaining"><span class="pill pill-remaining" data-remaining="…">…</span></div>
        <div class="slot-action">
          <button class="btn btn-signup" type="button" data-pick="Lunch Bouncers (11:15–12:30)">Sign Up</button>
        </div>
      </div>
    
      <div class="slot-row" data-slot="Serving/Clean-Up (11:15–12:15)" data-capacity="6">
        <div class="slot-main">
          <div class="slot-title"><strong>Serving/Clean-Up</strong> <span class="muted">(11:15–12:15)</span> • <span class="muted">3 pts</span></div>
        </div>
        <div class="slot-remaining"><span class="pill pill-remaining" data-remaining="…">…</span></div>
        <div class="slot-action">
          <button class="btn btn-signup" type="button" data-pick="Serving/Clean-Up (11:15–12:15)">Sign Up</button>
        </div>
      </div>
    
      <div class="slot-row" data-slot="Restroom Patrol (TBA)" data-capacity="4">
        <div class="slot-main">
          <div class="slot-title"><strong>Restroom Patrol</strong> <span class="muted">(TBA)</span> • <span class="muted">2 pts</span></div>
        </div>
        <div class="slot-remaining"><span class="pill pill-remaining" data-remaining="…">…</span></div>
        <div class="slot-action">
          <button class="btn btn-signup" type="button" data-pick="Restroom Patrol (TBA)">Sign Up</button>
        </div>
      </div>
    
      <div class="slot-row" data-slot="Teacher Hospitality (AM) (TBA)" data-capacity="3">
        <div class="slot-main">
          <div class="slot-title"><strong>Teacher Hospitality (AM)</strong> <span class="muted">(TBA)</span> • <span class="muted">2 pts</span></div>
        </div>
        <div class="slot-remaining"><span class="pill pill-remaining" data-remaining="…">…</span></div>
        <div class="slot-action">
          <button class="btn btn-signup" type="button" data-pick="Teacher Hospitality (AM) (TBA)">Sign Up</button>
        </div>
      </div>
    
      <div class="slot-row" data-slot="T|B Merchandise (11:00–12:30)" data-capacity="3">
        <div class="slot-main">
          <div class="slot-title"><strong>T|B Merchandise</strong> <span class="muted">(11:00–12:30)</span></div>
        </div>
        <div class="slot-remaining"><span class="pill pill-remaining" data-remaining="…">…</span></div>
        <div class="slot-action">
          <button class="btn btn-signup" type="button" data-pick="T|B Merchandise (11:00–12:30)">Sign Up</button>
        </div>
      </div>
    
      <div class="slot-row" data-slot="ACDA Merchandise (11:00–12:30)" data-capacity="3">
        <div class="slot-main">
          <div class="slot-title"><strong>ACDA Merchandise</strong> <span class="muted">(11:00–12:30)</span></div>
        </div>
        <div class="slot-remaining"><span class="pill pill-remaining" data-remaining="…">…</span></div>
        <div class="slot-action">
          <button class="btn btn-signup" type="button" data-pick="ACDA Merchandise (11:00–12:30)">Sign Up</button>
        </div>
      </div>
    
      <div class="slot-row" data-slot="NAfME Snack Table (11:00–12:30)" data-capacity="3">
        <div class="slot-main">
          <div class="slot-title"><strong>NAfME Snack Table</strong> <span class="muted">(11:00–12:30)</span> • <span class="muted">2 pts</span></div>
        </div>
        <div class="slot-remaining"><span class="pill pill-remaining" data-remaining="…">…</span></div>
        <div class="slot-action">
          <button class="btn btn-signup" type="button" data-pick="NAfME Snack Table (11:00–12:30)">Sign Up</button>
        </div>
      </div>
    
      <div class="slot-row" data-slot="153 Readiness Piano (TBA)" data-capacity="1">
        <div class="slot-main">
          <div class="slot-title"><strong>153 Readiness Piano</strong> <span class="muted">(TBA)</span></div>
        </div>
        <div class="slot-remaining"><span class="pill pill-remaining" data-remaining="…">…</span></div>
        <div class="slot-action">
          <button class="btn btn-signup" type="button" data-pick="153 Readiness Piano (TBA)">Sign Up</button>
        </div>
      </div>
    
      <div class="slot-row" data-slot="Sing-A-Long Band (TBA)" data-capacity="6">
        <div class="slot-main">
          <div class="slot-title"><strong>Sing-A-Long Band</strong> <span class="muted">(TBA)</span></div>
        </div>
        <div class="slot-remaining"><span class="pill pill-remaining" data-remaining="…">…</span></div>
        <div class="slot-action">
          <button class="btn btn-signup" type="button" data-pick="Sing-A-Long Band (TBA)">Sign Up</button>
        </div>
      </div>
    
      <div class="slot-row" data-slot="Sing-A-Long Lead (TBA)" data-capacity="1">
        <div class="slot-main">
          <div class="slot-title"><strong>Sing-A-Long Lead</strong> <span class="muted">(TBA)</span></div>
        </div>
        <div class="slot-remaining"><span class="pill pill-remaining" data-remaining="…">…</span></div>
        <div class="slot-action">
          <button class="btn btn-signup" type="button" data-pick="Sing-A-Long Lead (TBA)">Sign Up</button>
        </div>
      </div>
    
      <div class="slot-row" data-slot="PowerPoint (9:00–9:20)" data-capacity="1">
        <div class="slot-main">
          <div class="slot-title"><strong>PowerPoint</strong> <span class="muted">(9:00–9:20)</span></div>
        </div>
        <div class="slot-remaining"><span class="pill pill-remaining" data-remaining="…">…</span></div>
        <div class="slot-action">
          <button class="btn btn-signup" type="button" data-pick="PowerPoint (9:00–9:20)">Sign Up</button>
        </div>
      </div>
    
      <div class="slot-row" data-slot="Signage (create/place) (TBA)" data-capacity="3">
        <div class="slot-main">
          <div class="slot-title"><strong>Signage (create/place)</strong> <span class="muted">(TBA)</span></div>
        </div>
        <div class="slot-remaining"><span class="pill pill-remaining" data-remaining="…">…</span></div>
        <div class="slot-action">
          <button class="btn btn-signup" type="button" data-pick="Signage (create/place) (TBA)">Sign Up</button>
        </div>
      </div>
    
      <div class="slot-row" data-slot="Packet Collating (TBA)" data-capacity="6">
        <div class="slot-main">
          <div class="slot-title"><strong>Packet Collating</strong> <span class="muted">(TBA)</span></div>
        </div>
        <div class="slot-remaining"><span class="pill pill-remaining" data-remaining="…">…</span></div>
        <div class="slot-action">
          <button class="btn btn-signup" type="button" data-pick="Packet Collating (TBA)">Sign Up</button>
        </div>
      </div>
    
      <div class="slot-row" data-slot="Guest Artist Host (TBA)" data-capacity="2">
        <div class="slot-main">
          <div class="slot-title"><strong>Guest Artist Host</strong> <span class="muted">(TBA)</span></div>
        </div>
        <div class="slot-remaining"><span class="pill pill-remaining" data-remaining="…">…</span></div>
        <div class="slot-action">
          <button class="btn btn-signup" type="button" data-pick="Guest Artist Host (TBA)">Sign Up</button>
        </div>
      </div>
    
      <div class="slot-row" data-slot="Performers (permission req.) (TBA)" data-capacity="12">
        <div class="slot-main">
          <div class="slot-title"><strong>Performers (permission req.)</strong> <span class="muted">(TBA)</span></div>
        </div>
        <div class="slot-remaining"><span class="pill pill-remaining" data-remaining="…">…</span></div>
        <div class="slot-action">
          <button class="btn btn-signup" type="button" data-pick="Performers (permission req.) (TBA)">Sign Up</button>
        </div>
      </div>
    
        </div>
        <p class="small muted" style="margin-top:.5rem">Counts reflect accepted sign-ups. If a slot is full, the button will be disabled.</p>
      </div>
    </div>
  </section>

  <section class="section">
    <div class="container">
      <h2>Volunteer Sign-Up</h2>
      <form id="volForm" name="tenor-bass-volunteers" method="POST" data-netlify="true" netlify-honeypot="bot-field" action="/tenor-bass-festival/thanks.html">
        <input type="hidden" name="form-name" value="tenor-bass-volunteers">
        <p style="display:none"><label>Don’t fill this out: <input name="bot-field"/></label></p>

        <div class="pillbar" id="selectedRoleBar" hidden>
          Selected: <span id="selectedRole" class="pill"></span>
          <button class="link" id="clearPick" type="button" aria-label="Clear selection">change</button>
        </div>

        <div class="form-grid">
          <div class="form-field">
            <label for="first">First name</label>
            <input id="first" name="first" required autocomplete="given-name"/>
          </div>
          <div class="form-field">
            <label for="last">Last name</label>
            <input id="last" name="last" required autocomplete="family-name"/>
          </div>
          <div class="form-field">
            <label for="email">Email</label>
            <input id="email" name="email" type="email" required autocomplete="email"/>
          </div>
          <div class="form-field">
            <label for="affil">Affiliation</label>
            <input id="affil" name="affiliation" placeholder="Rowan ACDA / NAfME / other"/>
          </div>
          <div class="form-field">
            <label for="role">Preferred role</label>
            <select id="role" name="role" required>
              <option value="">Select…</option>
<option value="Bus Crew (7:30–9:30)">Bus Crew (7:30–9:30)</option>
<option value="Lobby Ushers (7:30–9:30)">Lobby Ushers (7:30–9:30)</option>
<option value="Registration (7:30–9:30)">Registration (7:30–9:30)</option>
<option value="Set-Up Crew (9:30–10:00)">Set-Up Crew (9:30–10:00)</option>
<option value="Lunch Bouncers (11:15–12:30)">Lunch Bouncers (11:15–12:30)</option>
<option value="Serving/Clean-Up (11:15–12:15)">Serving/Clean-Up (11:15–12:15)</option>
<option value="Restroom Patrol (TBA)">Restroom Patrol (TBA)</option>
<option value="Teacher Hospitality (AM) (TBA)">Teacher Hospitality (AM) (TBA)</option>
<option value="T|B Merchandise (11:00–12:30)">T|B Merchandise (11:00–12:30)</option>
<option value="ACDA Merchandise (11:00–12:30)">ACDA Merchandise (11:00–12:30)</option>
<option value="NAfME Snack Table (11:00–12:30)">NAfME Snack Table (11:00–12:30)</option>
<option value="153 Readiness Piano (TBA)">153 Readiness Piano (TBA)</option>
<option value="Sing-A-Long Band (TBA)">Sing-A-Long Band (TBA)</option>
<option value="Sing-A-Long Lead (TBA)">Sing-A-Long Lead (TBA)</option>
<option value="PowerPoint (9:00–9:20)">PowerPoint (9:00–9:20)</option>
<option value="Signage (create/place) (TBA)">Signage (create/place) (TBA)</option>
<option value="Packet Collating (TBA)">Packet Collating (TBA)</option>
<option value="Guest Artist Host (TBA)">Guest Artist Host (TBA)</option>
<option value="Performers (permission req.) (TBA)">Performers (permission req.) (TBA)</option>
            </select>
          </div>
          <div class="form-field">
            <label for="alt_role">Alternate role (optional)</label>
            <select id="alt_role" name="alternate_role">
              <option value="">Select…</option>
<option value="Bus Crew (7:30–9:30)">Bus Crew (7:30–9:30)</option>
<option value="Lobby Ushers (7:30–9:30)">Lobby Ushers (7:30–9:30)</option>
<option value="Registration (7:30–9:30)">Registration (7:30–9:30)</option>
<option value="Set-Up Crew (9:30–10:00)">Set-Up Crew (9:30–10:00)</option>
<option value="Lunch Bouncers (11:15–12:30)">Lunch Bouncers (11:15–12:30)</option>
<option value="Serving/Clean-Up (11:15–12:15)">Serving/Clean-Up (11:15–12:15)</option>
<option value="Restroom Patrol (TBA)">Restroom Patrol (TBA)</option>
<option value="Teacher Hospitality (AM) (TBA)">Teacher Hospitality (AM) (TBA)</option>
<option value="T|B Merchandise (11:00–12:30)">T|B Merchandise (11:00–12:30)</option>
<option value="ACDA Merchandise (11:00–12:30)">ACDA Merchandise (11:00–12:30)</option>
<option value="NAfME Snack Table (11:00–12:30)">NAfME Snack Table (11:00–12:30)</option>
<option value="153 Readiness Piano (TBA)">153 Readiness Piano (TBA)</option>
<option value="Sing-A-Long Band (TBA)">Sing-A-Long Band (TBA)</option>
<option value="Sing-A-Long Lead (TBA)">Sing-A-Long Lead (TBA)</option>
<option value="PowerPoint (9:00–9:20)">PowerPoint (9:00–9:20)</option>
<option value="Signage (create/place) (TBA)">Signage (create/place) (TBA)</option>
<option value="Packet Collating (TBA)">Packet Collating (TBA)</option>
<option value="Guest Artist Host (TBA)">Guest Artist Host (TBA)</option>
<option value="Performers (permission req.) (TBA)">Performers (permission req.) (TBA)</option>
            </select>
          </div>
          <div class="form-field">
            <label for="arrival">Earliest arrival (optional)</label>
            <input id="arrival" name="earliest_arrival" placeholder="e.g., 7:15 AM"/>
          </div>
          <div class="form-field">
            <label for="depart">Latest departure (optional)</label>
            <input id="depart" name="latest_departure" placeholder="e.g., 12:45 PM"/>
          </div>
          <div class="form-field form-field--full">
            <label for="notes">Notes</label>
            <textarea id="notes" name="notes" rows="3" placeholder="skills, restrictions, instrument for band, etc."></textarea>
          </div>
          <div class="form-field form-field--full">
            <label><input type="checkbox" name="permission_perform" value="yes"> I have permission to perform (if choosing a performer role).</label>
          </div>
        </div>

        <div class="actions">
          <button class="btn" type="submit">Submit volunteer form</button>
          <a class="btn btn-ghost" href="/">Back to ACDA home</a>
        </div>
      </form>
    </div>
  </section>
</main>

<footer class="site-footer acda-footer" role="contentinfo">
  <div class="container footer-grid">
    <!-- Brand / blurb -->
    <div class="footer-brand">
      <div class="brand--footer">
        <img src="/assets/icons/acda.png" alt="Rowan ACDA logo" width="40" height="40">
        <div class="brand-text">
          <strong>Rowan ACDA</strong>
          <div class="muted">Collegiate Chapter</div>
        </div>
      </div>
      <p class="muted" style="margin-top:.75rem">
        American Choral Directors Association at Rowan University. We sing, lead, and serve through choral music.
      </p>
    </div>

    <!-- Navigate -->
    <nav aria-label="Footer" class="footer-nav">
      <h4>Navigate</h4>
      <ul class="list-unstyled">
        <li><a href="/events.html">Events</a></li>
        <li><a href="/members.html">Members</a></li>
        <li><a href="/eboard.html">E-Board</a></li>
        <li><a href="/resources.html">Resources</a></li>
      </ul>
    </nav>

    <!-- Connect -->
    <div class="footer-connect">
      <h4>Connect</h4>
      <ul class="list-unstyled">
        <li><a href="mailto:rowanacda1@gmail.com">rowanacda1@gmail.com</a></li>
        <li><a href="https://www.instagram.com/rowanacda/" target="_blank" rel="noopener">Instagram</a></li>
      </ul>
      <p class="small muted footer-note">
        Site theme by Adam Bretz 
      </p>
      <p class="small muted">© <span id="year"></span> Rowan ACDA</p>
    </div>
  </div>
</footer>

<style>
.slots.card { padding: 0; }
.slots-head, .slot-row {
  display:grid; grid-template-columns: 1fr 140px 140px; gap:.5rem; align-items:center;
}
.slots-head { padding:.75rem 1rem; border-bottom:1px solid #e6ebf4; font-weight:700; background:var(--bg, #fafbff); }
.slots-body .slot-row { padding:.75rem 1rem; border-top:1px solid #e6ebf4; }
.slot-title { font-size:1rem; }
.center { text-align:center; }
.pill { display:inline-block; padding:.25rem .6rem; border-radius:999px; background:#eef2ff; }
.pill-remaining { background:#e9f7ef; }
.btn.btn-signup { width:100%; }
.pillbar { display:flex; align-items:center; gap:.5rem; margin:.75rem 0; }
.pillbar .link { background:none; border:0; color:var(--link, #1b4fb8); text-decoration:underline; cursor:pointer; }
</style>

<script>
(function(){
  const rows = Array.from(document.querySelectorAll('.slot-row'));
  const roleSel = document.getElementById('role');
  const altSel = document.getElementById('alt_role');
  const selectedBar = document.getElementById('selectedRoleBar');
  const selectedLabel = document.getElementById('selectedRole');
  const clearPick = document.getElementById('clearPick');
  const form = document.getElementById('volForm');

  function pickRole(val) {
    roleSel.value = val;
    selectedLabel.textContent = val;
    selectedBar.hidden = !val;
    roleSel.dispatchEvent(new Event('change'));
    document.getElementById('volForm').scrollIntoView({ behavior:'smooth', block:'start' });
  }

  rows.forEach(r => {
    const btn = r.querySelector('button[data-pick]');
    btn?.addEventListener('click', () => pickRole(btn.dataset.pick));
  });
  clearPick.addEventListener('click', () => pickRole(''));

  async function loadCounts() {
    try {
      const res = await fetch('/.netlify/functions/register-tb', { method:'OPTIONS' });
      if(!res.ok) throw 0;
      const res2 = await fetch('/.netlify/functions/register-tb?counts=1');
      if(!res2.ok) throw 0;
      const data = await res2.json();
      rows.forEach(row => {
        const key = row.dataset.slot;
        const cap = Number(row.dataset.capacity || 0);
        const used = (data.counts && data.counts[key]) || 0;
        const remaining = Math.max(cap - used, 0);
        const remEl = row.querySelector('[data-remaining]');
        const btn = row.querySelector('button[data-pick]');
        remEl.textContent = remaining + ' of ' + cap;
        if(remaining <= 0) { 
          remEl.textContent = 'Full';
          btn.disabled = true; 
        }
      });
    } catch { 
      rows.forEach(row => {
        const cap = Number(row.dataset.capacity || 0);
        row.querySelector('[data-remaining]').textContent = cap + ' slots';
      });
    }
  }
  loadCounts();

  form.addEventListener('submit', async (e) => {
    try {
      e.preventDefault();
      const data = Object.fromEntries(new FormData(form).entries());
      const res = await fetch('/.netlify/functions/register-tb', {
        method: 'POST',
        headers: { 'content-type': 'application/json' },
        body: JSON.stringify({
          first: data.first, last: data.last, email: data.email,
          role: data.role, alternate_role: data.alternate_role || '',
          notes: data.notes || ''
        })
      });
      const out = await res.json();
      if (!res.ok || !out.ok) { alert(out.message || out.error || 'Slot appears full.'); return; }
      window.location.href = form.action;
    } catch(err) { form.submit(); }
  });
})();
</script>
</body>
</html>
